<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ video_title }} - High Quality Stream</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: black;
        }
        #video-container {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #video-player {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
    </style>
</head>
<body>
    <div id="video-container">
        <video id="video-player" controls playsinline>
            ãƒ–ãƒ©ã‚¦ã‚¶ãŒã“ã®å½¢å¼ã®å‹•ç”»ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ã€‚
        </video>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/hls.js@1"></script>
    <script>
        const video = document.getElementById('video-player');
        const videoSrc = "{{ video_url }}"; // M3U8 URL

        // 1. ãƒ–ãƒ©ã‚¦ã‚¶ãŒãƒã‚¤ãƒ†ã‚£ãƒ–ã§HLSã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ã‹ã‚’ç¢ºèª
        // iOS/iPadOS/macOS (Safari) ã‚„ä¸€éƒ¨ã®Androidãƒ–ãƒ©ã‚¦ã‚¶ãŒã“ã‚Œã«è©²å½“
        const isNativeHLS = video.canPlayType('application/vnd.apple.mpegurl') || video.canPlayType('application/x-mpegurl');

        if (isNativeHLS) {
            // âœ… ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚µãƒãƒ¼ãƒˆãŒã‚ã‚‹å ´åˆ: HLS.jsã‚’ä½¿ã‚ãšã€ç›´æ¥URLã‚’è¨­å®š
            video.src = videoSrc;
            video.addEventListener('loadedmetadata', function() {
                video.play().catch(error => {
                    console.log("Autoplay blocked. User interaction required.");
                });
            });
            
        } else if (Hls.isSupported()) {
            // ğŸ’¡ HLS.jsãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹å ´åˆ (Chrome/Firefoxãªã©ã€ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚µãƒãƒ¼ãƒˆãŒãªã„ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ãƒ–ãƒ©ã‚¦ã‚¶)
            const hls = new Hls();
            hls.loadSource(videoSrc);
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, function() {
                video.play().catch(error => {
                    console.log("Autoplay blocked. User interaction required.");
                });
            });
            
        } else {
            // âŒ ã©ã¡ã‚‰ã®æ–¹å¼ã‚‚ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„å ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
            video.src = '';
            video.parentElement.innerHTML = 'HLSå‹•ç”»ã®å†ç”Ÿã«å¿…è¦ãªæŠ€è¡“ãŒãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚';
        }
    </script>
</body>
</html>
